<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MotoCompare â€” SrovnÃ¡nÃ­ motocyklÅ¯</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet" />
<style>
  :root {
    --bmw-blue: #E05C2A;
    --bmw-blue-light: #F07A4A;
    --bmw-blue-dark: #B8451A;
    --bg-0: #070A0F;
    --bg-1: #0D1117;
    --bg-2: #131920;
    --bg-3: #1A2231;
    --bg-card: #111827;
    --border: rgba(255,255,255,0.07);
    --border-blue: rgba(28,105,212,0.4);
    --text-primary: #F0F4FF;
    --text-secondary: #8899BB;
    --text-muted: #4A5870;
    --gold: #C9A84C;
    --red: #E84040;
    --green: #22C75E;
    --radius: 6px;
    --radius-lg: 12px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Barlow', sans-serif;
    background: var(--bg-0);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    background: rgba(7,10,15,0.92);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
  }
  .header-inner {
    max-width: 1400px; margin: 0 auto;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 2rem; height: 64px;
  }
  .logo {
    display: flex; align-items: center; gap: 14px;
    text-decoration: none;
  }
  .logo-icon {
    font-size: 1.7rem;
    color: var(--bmw-blue);
    flex-shrink: 0;
  }
  .logo-text { display: flex; flex-direction: column; line-height: 1; }
  .logo-text .brand { font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 1.1rem; letter-spacing: 0.15em; color: white; }
  .logo-text .sub { font-family: 'Barlow Condensed', sans-serif; font-weight: 300; font-size: 0.65rem; letter-spacing: 0.3em; color: var(--text-secondary); }
  .header-actions { display: flex; gap: 0.5rem; align-items: center; }
  .badge-count {
    background: var(--bmw-blue); color: white;
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 0.7rem;
    letter-spacing: 0.05em;
    padding: 2px 8px; border-radius: 20px; display: none;
  }
  .badge-count.visible { display: inline-block; }

  /* â”€â”€ BTN â”€â”€ */
  .btn {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 0.45rem 1rem; border-radius: var(--radius);
    font-family: 'Barlow Condensed', sans-serif; font-weight: 600; font-size: 0.85rem;
    letter-spacing: 0.08em; cursor: pointer; border: none; transition: all 0.2s;
    text-transform: uppercase;
  }
  .btn-primary { background: var(--bmw-blue); color: white; }
  .btn-primary:hover { background: var(--bmw-blue-light); }
  .btn-ghost { background: transparent; color: var(--text-secondary); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--bmw-blue); color: var(--text-primary); }
  .btn-danger { background: transparent; color: var(--red); border: 1px solid rgba(232,64,64,0.3); }
  .btn-danger:hover { background: rgba(232,64,64,0.1); }
  .btn-sm { padding: 0.3rem 0.7rem; font-size: 0.75rem; }
  .btn-lg { padding: 0.75rem 1.8rem; font-size: 1rem; }

  /* â”€â”€ HERO / URL INPUT SECTION â”€â”€ */
  .hero {
    min-height: 100vh; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 6rem 2rem 3rem;
    background:
      radial-gradient(ellipse 60% 50% at 50% -10%, rgba(28,105,212,0.18) 0%, transparent 60%),
      linear-gradient(180deg, var(--bg-0) 0%, var(--bg-1) 100%);
    position: relative;
  }
  .hero::before {
    content: '';
    position: absolute; bottom: -0.1em; left: 50%;
    transform: translateX(-50%);
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 22vw;
    color: rgba(255,255,255,0.018); line-height: 1; pointer-events: none;
    white-space: nowrap;
  }
  .hero-label {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 300;
    font-size: 0.7rem; letter-spacing: 0.5em; color: var(--bmw-blue);
    text-transform: uppercase; margin-bottom: 1.2rem;
    animation: fadeUp 0.6s ease both;
  }
  .hero-title {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
    font-size: clamp(2.8rem, 6vw, 5rem);
    letter-spacing: -0.01em; line-height: 0.95;
    text-align: center; margin-bottom: 0.6rem;
    animation: fadeUp 0.6s 0.1s ease both;
  }
  .hero-title span { color: var(--bmw-blue); }
  .hero-sub {
    color: var(--text-secondary); font-size: 1rem; font-weight: 300;
    text-align: center; max-width: 480px; line-height: 1.6;
    margin-bottom: 3rem;
    animation: fadeUp 0.6s 0.2s ease both;
  }

  /* â”€â”€ URL INPUT CARD â”€â”€ */
  .url-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 2rem;
    width: 100%; max-width: 700px;
    animation: fadeUp 0.6s 0.3s ease both;
    box-shadow: 0 32px 80px rgba(0,0,0,0.5);
  }
  .url-card h3 {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 0.75rem; letter-spacing: 0.3em; color: var(--text-secondary);
    text-transform: uppercase; margin-bottom: 1rem;
  }
  .url-row { display: flex; gap: 0.5rem; }
  .url-input {
    flex: 1;
    background: var(--bg-2); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text-primary);
    font-family: 'Barlow', sans-serif; font-size: 0.9rem;
    padding: 0.65rem 1rem; outline: none;
    transition: border-color 0.2s;
  }
  .url-input:focus { border-color: var(--bmw-blue); }
  .url-input::placeholder { color: var(--text-muted); }

  .divider {
    display: flex; align-items: center; gap: 1rem;
    margin: 1.2rem 0;
    color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.1em;
  }
  .divider::before, .divider::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  /* â”€â”€ MANUAL FORM â”€â”€ */
  .manual-form { display: none; }
  .manual-form.open { display: block; }
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
  .form-group { display: flex; flex-direction: column; gap: 0.3rem; }
  .form-group.full { grid-column: 1/-1; }
  .form-group label {
    font-size: 0.7rem; font-weight: 600; letter-spacing: 0.15em;
    text-transform: uppercase; color: var(--text-muted);
  }
  .form-group input, .form-group select, .form-group textarea {
    background: var(--bg-2); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text-primary);
    font-family: 'Barlow', sans-serif; font-size: 0.9rem;
    padding: 0.55rem 0.8rem; outline: none;
    transition: border-color 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: var(--bmw-blue);
  }
  .form-group select { cursor: pointer; }
  .form-group option { background: var(--bg-2); }
  .star-row { display: flex; gap: 4px; }
  .star {
    font-size: 1.2rem; cursor: pointer; color: var(--text-muted);
    transition: color 0.15s;
  }
  .star.active, .star:hover { color: var(--gold); }

  /* â”€â”€ STATUS BAR â”€â”€ */
  .status-bar {
    margin-top: 1rem; padding: 0.6rem 1rem;
    border-radius: var(--radius); font-size: 0.82rem;
    display: none; align-items: center; gap: 0.5rem;
  }
  .status-bar.show { display: flex; }
  .status-bar.loading { background: rgba(28,105,212,0.1); border: 1px solid var(--border-blue); color: var(--bmw-blue-light); }
  .status-bar.success { background: rgba(34,199,94,0.08); border: 1px solid rgba(34,199,94,0.2); color: var(--green); }
  .status-bar.error { background: rgba(232,64,64,0.08); border: 1px solid rgba(232,64,64,0.2); color: var(--red); }
  .spinner {
    width: 14px; height: 14px; border: 2px solid transparent;
    border-top-color: currentColor; border-radius: 50%;
    animation: spin 0.7s linear infinite; flex-shrink: 0;
  }

  /* â”€â”€ COMPARISON SECTION â”€â”€ */
  .section {
    max-width: 1400px; margin: 0 auto;
    padding: 4rem 2rem;
  }
  .section-header {
    display: flex; align-items: flex-end; justify-content: space-between;
    margin-bottom: 2rem; padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
  }
  .section-title {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
    font-size: 2.2rem; letter-spacing: -0.01em;
    line-height: 1;
  }
  .section-title span { color: var(--bmw-blue); }
  .section-count {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 300;
    font-size: 0.75rem; letter-spacing: 0.3em; color: var(--text-secondary);
    text-transform: uppercase;
  }

  /* â”€â”€ BIKE CARDS GRID â”€â”€ */
  .bikes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }
  .bike-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: border-color 0.25s, transform 0.25s;
    position: relative;
  }
  .bike-card:hover { border-color: rgba(28,105,212,0.5); transform: translateY(-3px); }
  .bike-card.best-value { border-color: rgba(201,168,76,0.4); }
  .bike-card.best-value::before {
    content: 'â˜… NEJLEPÅ Ã HODNOTA';
    position: absolute; top: 10px; right: 10px; z-index: 2;
    background: var(--gold); color: var(--bg-0);
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 0.6rem; letter-spacing: 0.15em;
    padding: 3px 8px; border-radius: 3px;
  }
  .bike-photo {
    width: 100%; height: 200px; object-fit: cover;
    background: var(--bg-2);
    display: block;
  }
  .bike-photo-placeholder {
    width: 100%; height: 200px;
    background: var(--bg-2);
    display: flex; align-items: center; justify-content: center;
    color: var(--text-muted); font-size: 3rem;
  }
  .bike-body { padding: 1.2rem; }
  .bike-model {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
    font-size: 1.3rem; letter-spacing: -0.01em; margin-bottom: 0.2rem;
  }
  .bike-year-origin { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.8rem; }
  .bike-price {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 1.6rem; color: var(--bmw-blue); margin-bottom: 0.8rem;
  }
  .bike-stats {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 0.5rem; margin-bottom: 1rem;
  }
  .bike-stat { display: flex; flex-direction: column; gap: 1px; }
  .bike-stat .label { font-size: 0.65rem; font-weight: 600; letter-spacing: 0.12em; color: var(--text-muted); text-transform: uppercase; }
  .bike-stat .value { font-size: 0.88rem; font-weight: 500; color: var(--text-primary); }
  .stk-badge {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 0.7rem; font-weight: 600; letter-spacing: 0.08em;
    padding: 2px 8px; border-radius: 3px; text-transform: uppercase;
  }
  .stk-ok { background: rgba(34,199,94,0.12); color: var(--green); border: 1px solid rgba(34,199,94,0.25); }
  .stk-warn { background: rgba(201,168,76,0.12); color: var(--gold); border: 1px solid rgba(201,168,76,0.25); }
  .stk-unknown { background: rgba(255,255,255,0.04); color: var(--text-muted); border: 1px solid var(--border); }
  .bike-stars { display: flex; gap: 3px; margin-bottom: 0.6rem; }
  .bike-stars span { font-size: 0.9rem; }
  .bike-notes {
    font-size: 0.78rem; color: var(--text-secondary); font-style: italic;
    border-left: 2px solid var(--border-blue);
    padding-left: 0.6rem; margin-bottom: 0.8rem;
    display: none;
  }
  .bike-notes.has-notes { display: block; }
  .bike-actions { display: flex; gap: 0.4rem; flex-wrap: wrap; }
  .bike-url-link {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 0.72rem; color: var(--bmw-blue); text-decoration: none;
    letter-spacing: 0.05em; font-weight: 600;
    transition: color 0.15s;
  }
  .bike-url-link:hover { color: var(--bmw-blue-light); }

  /* â”€â”€ COMPARISON TABLE â”€â”€ */
  .table-wrap {
    overflow-x: auto;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
  }
  .comp-table {
    width: 100%; border-collapse: collapse;
    font-size: 0.88rem;
  }
  .comp-table thead {
    background: var(--bg-3);
  }
  .comp-table th {
    padding: 1rem 1.2rem; text-align: left;
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--text-secondary); border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }
  .comp-table td {
    padding: 0.85rem 1.2rem;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }
  .comp-table tr:last-child td { border-bottom: none; }
  .comp-table tr:hover td { background: rgba(28,105,212,0.04); }
  .comp-table .thumb {
    width: 64px; height: 44px; object-fit: cover;
    border-radius: 4px; display: block;
    background: var(--bg-2);
  }
  .comp-table .thumb-placeholder {
    width: 64px; height: 44px; border-radius: 4px;
    background: var(--bg-2); display: flex;
    align-items: center; justify-content: center;
    color: var(--text-muted); font-size: 1.2rem;
  }
  .comp-table .price-cell {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 1.1rem; color: var(--bmw-blue);
  }
  .val-best { color: var(--green); font-weight: 600; }

  /* â”€â”€ FAVORITE STAR â”€â”€ */
  .fav-btn {
    position: absolute; top: 10px; left: 10px; z-index: 3;
    width: 32px; height: 32px; border-radius: 50%;
    background: rgba(0,0,0,0.55); border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 1rem; transition: transform 0.2s, background 0.2s;
    line-height: 1;
  }
  .fav-btn:hover { transform: scale(1.2); background: rgba(0,0,0,0.75); }
  .fav-btn.active { background: rgba(201,168,76,0.25); }
  .fav-badge {
    display: inline-flex; align-items: center; gap: 3px;
    font-size: 0.68rem; font-weight: 700; letter-spacing: 0.1em;
    color: var(--gold); text-transform: uppercase;
  }
  .val-worst { color: var(--red); }

  /* â”€â”€ FILTER BAR â”€â”€ */
  .filter-bar {
    display: flex; flex-wrap: wrap; gap: 0.6rem;
    align-items: flex-end;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius-lg); padding: 1rem 1.2rem;
    margin-bottom: 1rem;
  }
  .filter-group {
    display: flex; flex-direction: column; gap: 0.25rem;
    min-width: 110px;
  }
  .filter-group label {
    font-size: 0.62rem; font-weight: 700; letter-spacing: 0.15em;
    text-transform: uppercase; color: var(--text-muted);
  }
  .filter-group input, .filter-group select {
    background: var(--bg-2); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text-primary);
    font-family: 'Barlow', sans-serif; font-size: 0.82rem;
    padding: 0.4rem 0.6rem; outline: none; transition: border-color 0.2s;
  }
  .filter-group input:focus, .filter-group select:focus { border-color: var(--bmw-blue); }
  .filter-group select option { background: var(--bg-2); }

  /* sortable th */
  .th-sort {
    cursor: pointer; user-select: none; white-space: nowrap;
    transition: color 0.15s;
  }
  .th-sort:hover { color: var(--bmw-blue-light) !important; }
  .sort-icon { font-size: 0.7em; opacity: 0.6; }
  .empty-state {
    text-align: center; padding: 5rem 2rem;
    display: none;
  }
  .empty-state.visible { display: block; }
  .empty-state .icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.3; }
  .empty-state p { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6; }

  /* â”€â”€ PHOTO GALLERY â”€â”€ */
  .photos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.5rem; margin-top: 0.8rem;
  }
  .photo-thumb {
    width: 100%; aspect-ratio: 4/3;
    object-fit: cover; border-radius: 4px;
    cursor: pointer; transition: opacity 0.2s;
    border: 1px solid var(--border);
  }
  .photo-thumb:hover { opacity: 0.8; }

  /* â”€â”€ LIGHTBOX â”€â”€ */
  .lightbox {
    display: none; position: fixed; inset: 0; z-index: 999;
    background: rgba(0,0,0,0.92);
    align-items: center; justify-content: center;
  }
  .lightbox.open { display: flex; }
  .lightbox img { max-width: 90vw; max-height: 85vh; border-radius: var(--radius); }
  .lightbox-close {
    position: absolute; top: 1.5rem; right: 1.5rem;
    background: rgba(255,255,255,0.1); border: none; color: white;
    width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .lightbox-close:hover { background: rgba(255,255,255,0.2); }

  /* â”€â”€ TOAST â”€â”€ */
  .toast-container { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 200; display: flex; flex-direction: column; gap: 0.5rem; }
  .toast {
    background: var(--bg-3); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 0.7rem 1.2rem;
    font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem;
    animation: slideIn 0.3s ease; max-width: 320px;
  }
  .toast.success { border-color: rgba(34,199,94,0.3); color: var(--green); }
  .toast.error { border-color: rgba(232,64,64,0.3); color: var(--red); }
  .toast.info { border-color: var(--border-blue); color: var(--bmw-blue-light); }

  /* â”€â”€ FEATURES NOTE â”€â”€ */
  .features-list {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius-lg); padding: 1.5rem 2rem;
    margin-top: 3rem;
  }
  .features-list h4 {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 0.7rem; letter-spacing: 0.3em; color: var(--text-muted);
    text-transform: uppercase; margin-bottom: 1rem;
  }
  .features-chips { display: flex; flex-wrap: wrap; gap: 0.5rem; }
  .chip {
    padding: 4px 12px; border-radius: 20px;
    font-size: 0.75rem; font-weight: 500;
    display: inline-flex; align-items: center; gap: 4px;
  }
  .chip-blue { background: rgba(28,105,212,0.12); border: 1px solid var(--border-blue); color: var(--bmw-blue-light); }
  .chip-gold { background: rgba(201,168,76,0.1); border: 1px solid rgba(201,168,76,0.3); color: var(--gold); }
  .chip-note { background: rgba(255,255,255,0.04); border: 1px solid var(--border); color: var(--text-secondary); }

  /* â”€â”€ SORTING BAR â”€â”€ */
  .sort-bar { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.5rem; }
  .sort-bar label { font-size: 0.75rem; color: var(--text-secondary); letter-spacing: 0.1em; text-transform: uppercase; font-weight: 600; }
  .sort-btn {
    padding: 0.3rem 0.8rem;
    border-radius: 20px; border: 1px solid var(--border);
    background: transparent; color: var(--text-secondary);
    font-family: 'Barlow Condensed', sans-serif; font-weight: 600;
    font-size: 0.75rem; letter-spacing: 0.1em; cursor: pointer;
    transition: all 0.15s;
  }
  .sort-btn.active, .sort-btn:hover { background: var(--bmw-blue); border-color: var(--bmw-blue); color: white; }

  /* â”€â”€ FOOTER â”€â”€ */
  footer {
    border-top: 1px solid var(--border);
    padding: 1.5rem 2rem;
    text-align: center;
    color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.1em;
  }
  footer a { color: var(--bmw-blue); text-decoration: none; }

  /* â”€â”€ ANIMATIONS â”€â”€ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes fadeOut {
    to { opacity: 0; transform: translateX(20px); }
  }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 640px) {
    .header-inner { padding: 0 1rem; }
    .hero { padding: 5rem 1rem 2rem; }
    .section { padding: 2.5rem 1rem; }
    .section-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
    .form-grid { grid-template-columns: 1fr; }
    .bikes-grid { grid-template-columns: 1fr; }
  }

  /* â”€â”€ DETAIL MODAL â”€â”€ */
  .modal-overlay {
    display: none; position: fixed; inset: 0; z-index: 500;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(6px);
    align-items: center; justify-content: center; padding: 1rem;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--bg-1); border: 1px solid var(--border);
    border-radius: var(--radius-lg); width: 100%; max-width: 900px;
    max-height: 90vh; overflow-y: auto;
    animation: fadeUp 0.25s ease;
  }
  .modal-hero {
    position: relative; width: 100%; height: 380px; overflow: hidden;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    background: var(--bg-2); cursor: pointer;
  }
  .modal-hero img {
    width: 100%; height: 100%; object-fit: cover;
    transition: opacity 0.3s;
  }
  .modal-hero-nav {
    position: absolute; top: 50%; transform: translateY(-50%);
    display: flex; justify-content: space-between; width: 100%; padding: 0 0.8rem;
    pointer-events: none;
  }
  .modal-nav-btn {
    pointer-events: all; background: rgba(0,0,0,0.55); border: none; color: white;
    width: 38px; height: 38px; border-radius: 50%; font-size: 1.1rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .modal-nav-btn:hover { background: rgba(28,105,212,0.7); }
  .modal-photo-count {
    position: absolute; bottom: 10px; right: 12px;
    background: rgba(0,0,0,0.6); color: white; font-size: 0.72rem;
    font-family: 'Barlow Condensed', sans-serif; font-weight: 600;
    letter-spacing: 0.1em; padding: 3px 10px; border-radius: 20px;
  }
  .modal-thumbs {
    display: flex; gap: 0.4rem; padding: 0.7rem 1.2rem;
    overflow-x: auto; background: var(--bg-2);
  }
  .modal-thumb {
    width: 72px; height: 52px; object-fit: cover; border-radius: 4px;
    cursor: pointer; border: 2px solid transparent; flex-shrink: 0;
    transition: border-color 0.15s, opacity 0.15s; opacity: 0.65;
  }
  .modal-thumb.active { border-color: var(--bmw-blue); opacity: 1; }
  .modal-thumb:hover { opacity: 0.9; }
  .modal-body { padding: 1.5rem; }
  .modal-header {
    display: flex; align-items: flex-start; justify-content: space-between;
    margin-bottom: 1.2rem; gap: 1rem;
  }
  .modal-title {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
    font-size: 1.8rem; letter-spacing: -0.01em; line-height: 1;
  }
  .modal-price {
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    font-size: 2rem; color: var(--bmw-blue); white-space: nowrap;
  }
  .modal-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 0.8rem; margin-bottom: 1.2rem;
  }
  .modal-stat { background: var(--bg-3); border-radius: var(--radius); padding: 0.7rem 1rem; }
  .modal-stat .label { font-size: 0.62rem; font-weight: 700; letter-spacing: 0.18em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.2rem; }
  .modal-stat .value { font-size: 1rem; font-weight: 600; color: var(--text-primary); }
  .modal-notes {
    background: var(--bg-3); border-left: 3px solid var(--bmw-blue);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 0.8rem 1rem; font-size: 0.88rem; color: var(--text-secondary);
    font-style: italic; margin-bottom: 1rem;
  }
  .modal-footer {
    display: flex; gap: 0.5rem; flex-wrap: wrap;
    padding-top: 1rem; border-top: 1px solid var(--border);
  }
  .modal-close-btn {
    position: absolute; top: 10px; right: 10px; z-index: 10;
    background: rgba(0,0,0,0.6); border: none; color: white;
    width: 34px; height: 34px; border-radius: 50%; font-size: 1rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .modal-close-btn:hover { background: var(--red); }

</style>
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€ -->
<header>
  <div class="header-inner">
    <a class="logo" href="#">
<i class="fa-solid fa-motorcycle logo-icon" aria-hidden="true"></i>
      <div class="logo-text">
        <span class="brand">MOTO COMPARE</span>
        <span class="sub">srovnÃ¡nÃ­ motocyklÅ¯</span>
      </div>
    </a>
    <div class="header-actions">
      <span id="headerCount" class="badge-count">0 motocyklÅ¯</span>
      <button class="btn btn-ghost btn-sm" onclick="exportCSV()">â¬‡ Export CSV</button>
      <button class="btn btn-ghost btn-sm" onclick="shareList()">ğŸ”— SdÃ­let</button>
      <button class="btn btn-ghost btn-sm" onclick="clearAll()">ğŸ—‘ Vymazat vÅ¡e</button>
      <a href="#compare" class="btn btn-primary btn-sm">Srovnat â†’</a>
    </div>
  </div>
</header>

<!-- â”€â”€ HERO â”€â”€ -->
<main>
<section class="hero" id="home">
  <p class="hero-label">Vyberte si svÅ¯j pÅ™Ã­Å¡tÃ­ motocykl</p>
  <h1 class="hero-title">Porovnej <span>moto</span><br/>inzerÃ¡ty</h1>
  <p class="hero-sub">VloÅ¾ URL inzerÃ¡tu z bazos.cz, sauto.cz nebo tipcars.com â€” aplikace automaticky naÄte data a pÅ™idÃ¡ motocykl do srovnÃ¡nÃ­.</p>

  <!-- URL CARD -->
  <div class="url-card">
    <h3>ğŸ”— NaÄÃ­st z URL</h3>
    <div class="url-row">
      <input type="url" class="url-input" id="urlInput"
        placeholder="https://www.sauto.cz/inzerce/detail/... nebo tipcars.com, bazos.cz..."
        onkeydown="if(event.key==='Enter') fetchBike()"/>
      <button class="btn btn-primary btn-lg" onclick="fetchBike()">NaÄÃ­st</button>
    </div>
    <div id="statusBar" class="status-bar"></div>

    <div style="margin-top:0.7rem">
      <button class="btn btn-ghost btn-sm" onclick="toggleBulk()" id="bulkToggleBtn">âŠ PÅ™idat vÃ­ce URL najednou</button>
    </div>

    <div id="bulkSection" style="display:none;margin-top:0.8rem">
      <label style="font-size:0.7rem;font-weight:600;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);display:block;margin-bottom:0.4rem">KaÅ¾dÃ¡ URL na novÃ½ Å™Ã¡dek (max 50)</label>
      <textarea id="bulkInput" rows="5"
        style="width:100%;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);color:var(--text-primary);font-family:'Barlow',sans-serif;font-size:0.82rem;padding:0.6rem 0.8rem;outline:none;resize:vertical;line-height:1.8;transition:border-color 0.2s"
        onfocus="this.style.borderColor='var(--bmw-blue)'" onblur="this.style.borderColor=''"
        placeholder="https://motorky.bazos.cz/inzerat/111...&#10;https://www.sauto.cz/inzerce/detail/...&#10;https://www.tipcars.com/..."></textarea>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-top:0.5rem;flex-wrap:wrap;gap:0.5rem">
        <span id="bulkCounter" style="font-size:0.75rem;color:var(--text-muted)">0 URL</span>
        <button class="btn btn-primary" id="bulkStartBtn" onclick="fetchBulk()">â¬‡ NaÄÃ­st vÅ¡echny</button>
        <button class="btn btn-danger" id="bulkStopBtn" onclick="stopBulk()" style="display:none">â¹ Stop</button>
      </div>
      <div id="bulkProgress" style="display:none;margin-top:0.8rem">
        <div style="height:3px;background:var(--bg-3);border-radius:2px;overflow:hidden;margin-bottom:0.6rem">
          <div id="bulkProgressBar" style="height:100%;background:var(--bmw-blue);border-radius:2px;width:0%;transition:width 0.5s"></div>
        </div>
        <div id="bulkLog" style="font-size:0.78rem;color:var(--text-secondary);line-height:2;max-height:130px;overflow-y:auto"></div>
      </div>
    </div>

    <div class="divider">nebo vyplnit ruÄnÄ›</div>

    <button class="btn btn-ghost" onclick="toggleManual()">+ PÅ™idat manuÃ¡lnÄ›</button>

    <div id="manualForm" class="manual-form">
      <div class="form-grid" style="margin-top:1rem">
        <div class="form-group full">
          <label>Model / nÃ¡zev</label>
          <input type="text" id="f_model" placeholder="Honda Africa Twin, KTM 890 Adventure..." />
        </div>
        <div class="form-group">
          <label>Rok vÃ½roby</label>
          <input type="number" id="f_year" placeholder="2021" min="1990" max="2025" />
        </div>
        <div class="form-group">
          <label>Cena (KÄ)</label>
          <input type="number" id="f_price" placeholder="450000" />
        </div>
        <div class="form-group">
          <label>NajetÃ© km</label>
          <input type="number" id="f_km" placeholder="35000" />
        </div>
        <div class="form-group">
          <label>PÅ¯vod</label>
          <select id="f_origin">
            <option value="">â€” NevÃ­m â€”</option>
            <option value="CZ">ğŸ‡¨ğŸ‡¿ ÄŒeskÃ¡ republika</option>
            <option value="SK">ğŸ‡¸ğŸ‡° Slovensko</option>
            <option value="DE">ğŸ‡©ğŸ‡ª NÄ›mecko</option>
            <option value="AT">ğŸ‡¦ğŸ‡¹ Rakousko</option>
            <option value="PL">ğŸ‡µğŸ‡± Polsko</option>
            <option value="HU">ğŸ‡­ğŸ‡º MaÄarsko</option>
            <option value="IT">ğŸ‡®ğŸ‡¹ ItÃ¡lie</option>
            <option value="FR">ğŸ‡«ğŸ‡· Francie</option>
            <option value="GB">ğŸ‡¬ğŸ‡§ VelkÃ¡ BritÃ¡nie</option>
            <option value="US">ğŸ‡ºğŸ‡¸ USA</option>
            <option value="Other">ğŸŒ JinÃ½</option>
          </select>
        </div>
        <div class="form-group">
          <label>STK platnÃ¡ do</label>
          <input type="month" id="f_stk" />
        </div>
        <div class="form-group">
          <label>VÃ½kon (kW)</label>
          <input type="number" id="f_power" placeholder="100" />
        </div>
        <div class="form-group">
          <label>Objem (ccm)</label>
          <input type="number" id="f_ccm" placeholder="1254" />
        </div>
        <div class="form-group full">
          <label>URL inzerÃ¡tu</label>
          <input type="url" id="f_url" placeholder="https://..." />
        </div>
        <div class="form-group full">
          <label>URL nÃ¡hledovÃ© fotografie</label>
          <input type="url" id="f_photo" placeholder="https://...foto.jpg" />
        </div>
        <div class="form-group full">
          <label>PoznÃ¡mky / postÅ™ehy</label>
          <textarea id="f_notes" rows="2" placeholder="ServisnÃ­ knÃ­Å¾ka, pÅ™Ã­sluÅ¡enstvÃ­, dojmy..."></textarea>
        </div>
        <div class="form-group full">
          <label>HodnocenÃ­</label>
          <div class="star-row" id="starRow">
            <span class="star" data-v="1">â˜…</span>
            <span class="star" data-v="2">â˜…</span>
            <span class="star" data-v="3">â˜…</span>
            <span class="star" data-v="4">â˜…</span>
            <span class="star" data-v="5">â˜…</span>
          </div>
        </div>
        <div class="form-group full" style="justify-content: flex-end; flex-direction: row; gap: 0.5rem;">
          <button class="btn btn-ghost" onclick="toggleManual()">ZruÅ¡it</button>
          <button class="btn btn-primary" onclick="addManual()">PÅ™idat do srovnÃ¡nÃ­ â†’</button>
        </div>
      </div>
    </div>
  </div><!-- /url-card -->

  <!-- FEATURES NOTE -->
  <div class="features-list" style="max-width:700px;width:100%">
    <h4>âœ“ Funkce aplikace</h4>
    <div class="features-chips">
      <span class="chip chip-blue">ğŸ”— NaÄtenÃ­ z URL (sauto, tipcars, bazos...)</span>
      <span class="chip chip-blue">ğŸ–¼ StaÅ¾enÃ­ fotek inzerÃ¡tu</span>
      <span class="chip chip-blue">ğŸ“Š SrovnÃ¡vacÃ­ tabulka</span>
      <span class="chip chip-blue">ğŸ’¾ UklÃ¡dÃ¡nÃ­ v prohlÃ­Å¾eÄi (localStorage)</span>
      <span class="chip chip-gold">â¬‡ Export do CSV</span>
      <span class="chip chip-gold">â˜… HodnocenÃ­ motocyklu</span>
      <span class="chip chip-gold">ğŸ“ OsobnÃ­ poznÃ¡mky</span>
      <span class="chip chip-gold">ğŸ† OznaÄenÃ­ nejlepÅ¡Ã­ hodnoty</span>
      <span class="chip chip-note">âš  Scraping pÅ™es CORS proxy (omezenÃ­ dle zdroje)</span>
      <span class="chip chip-note">ğŸ“± ResponzivnÃ­ design</span>
    </div>
  </div>
</section>

<!-- â”€â”€ COMPARISON SECTION â”€â”€ -->
<section class="section" id="compare">
  <div class="section-header">
    <div>
      <div class="section-title">SrovnÃ¡nÃ­ <span>moto</span></div>
      <div class="section-count" id="bikeCount">0 motocyklÅ¯ v databÃ¡zi</div>
    </div>
    <div class="sort-bar">
      <label>Å˜adit:</label>
      <button class="sort-btn active" data-sort="added">PÅ™idÃ¡no</button>
      <button class="sort-btn" data-sort="price_asc">Cena â†‘</button>
      <button class="sort-btn" data-sort="price_desc">Cena â†“</button>
      <button class="sort-btn" data-sort="km">Km â†‘</button>
      <button class="sort-btn" data-sort="year">Rok â†“</button>
      <button class="sort-btn" data-sort="rating">HodnocenÃ­</button>
      <button class="sort-btn" data-sort="favorite">â˜… OblÃ­benÃ©</button>
    </div>
  </div>

  <!-- CARDS -->
  <div id="bikesGrid" class="bikes-grid"></div>

  <div id="emptyState" class="empty-state">
    <div class="icon">ğŸ</div>
    <p>Å½Ã¡dnÃ© motocykly zatÃ­m.<br/>VloÅ¾ URL inzerÃ¡tu nebo pÅ™idej manuÃ¡lnÄ›.</p>
  </div>

  <!-- TABLE -->
  <div id="tableSection" style="display:none">
    <div class="section-header" style="margin-top:2rem">
      <div class="section-title" style="font-size:1.5rem">PÅ™ehledovÃ¡ <span>tabulka</span></div>
      <span id="tableRowCount" style="font-size:0.75rem;color:var(--text-secondary);letter-spacing:0.1em"></span>
    </div>

    <!-- FILTER BAR -->
    <div class="filter-bar" id="filterBar">
      <div class="filter-group">
        <label>Model</label>
        <input type="text" id="fModel" placeholder="Hledat..." oninput="applyTableFilters()" />
      </div>
      <div class="filter-group">
        <label>Rok od</label>
        <input type="number" id="fYearMin" placeholder="2018" min="1990" max="2025" oninput="applyTableFilters()" />
      </div>
      <div class="filter-group">
        <label>Rok do</label>
        <input type="number" id="fYearMax" placeholder="2025" min="1990" max="2025" oninput="applyTableFilters()" />
      </div>
      <div class="filter-group">
        <label>Cena max (KÄ)</label>
        <input type="number" id="fPriceMax" placeholder="600000" oninput="applyTableFilters()" />
      </div>
      <div class="filter-group">
        <label>Km max</label>
        <input type="number" id="fKmMax" placeholder="80000" oninput="applyTableFilters()" />
      </div>
      <div class="filter-group">
        <label>PÅ¯vod</label>
        <select id="fOrigin" onchange="applyTableFilters()">
          <option value="">VÅ¡echny</option>
          <option value="CZ">ğŸ‡¨ğŸ‡¿ CZ</option>
          <option value="SK">ğŸ‡¸ğŸ‡° SK</option>
          <option value="DE">ğŸ‡©ğŸ‡ª DE</option>
          <option value="AT">ğŸ‡¦ğŸ‡¹ AT</option>
          <option value="PL">ğŸ‡µğŸ‡± PL</option>
          <option value="HU">ğŸ‡­ğŸ‡º HU</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ IT</option>
          <option value="FR">ğŸ‡«ğŸ‡· FR</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ GB</option>
        </select>
      </div>
      <div class="filter-group">
        <label>STK</label>
        <select id="fStk" onchange="applyTableFilters()">
          <option value="">VÅ¡e</option>
          <option value="ok">âœ“ PlatnÃ¡</option>
          <option value="warn">âš  Brzy expiruje</option>
          <option value="unknown">NeznÃ¡mÃ¡</option>
        </select>
      </div>
      <div class="filter-group">
        <label>HodnocenÃ­ min</label>
        <select id="fRating" onchange="applyTableFilters()">
          <option value="0">VÅ¡e</option>
          <option value="3">â˜…â˜…â˜…+</option>
          <option value="4">â˜…â˜…â˜…â˜…+</option>
          <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
        </select>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="resetFilters()" style="align-self:flex-end">âœ• Reset</button>
    </div>

    <div class="table-wrap">
      <table class="comp-table">
        <thead>
          <tr>
            <th>Foto</th>
            <th class="th-sort" data-col="model" onclick="tableSort('model')">Model <span class="sort-icon">â‡…</span></th>
            <th class="th-sort" data-col="year" onclick="tableSort('year')">Rok <span class="sort-icon">â‡…</span></th>
            <th class="th-sort" data-col="price" onclick="tableSort('price')">Cena <span class="sort-icon">â‡…</span></th>
            <th class="th-sort" data-col="km" onclick="tableSort('km')">Km <span class="sort-icon">â‡…</span></th>
            <th>PÅ¯vod</th>
            <th>STK</th>
            <th class="th-sort" data-col="power" onclick="tableSort('power')">VÃ½kon <span class="sort-icon">â‡…</span></th>
            <th class="th-sort" data-col="ccm" onclick="tableSort('ccm')">Objem <span class="sort-icon">â‡…</span></th>
            <th class="th-sort" data-col="rating" onclick="tableSort('rating')">HodnocenÃ­ <span class="sort-icon">â‡…</span></th>
            <th>Zdroj</th>
          </tr>
        </thead>
        <tbody id="compTableBody"></tbody>
      </table>
    </div>
    <div id="tableEmpty" style="display:none;text-align:center;padding:2rem;color:var(--text-muted);font-size:0.9rem">
      Å½Ã¡dnÃ© vÃ½sledky pro aktuÃ¡lnÃ­ filtry.
    </div>
  </div>
</section>
</main>

<!-- FOOTER -->
<footer>
  <p>MotoCompare â€” srovnÃ¡vaÄ motocyklovÃ½ch inzerÃ¡tÅ¯ &nbsp;Â·&nbsp;
  <a href="https://github.com/davebiker/bike-compare" target="_blank">github.com/davebiker/bike-compare</a></p>
</footer>


<!-- â”€â”€ DETAIL MODAL â”€â”€ -->
<div class="modal-overlay" id="detailModal" onclick="closeDetail(event)">
  <div class="modal" id="detailModalInner">
    <div class="modal-hero" id="modalHero">
      <img id="modalMainPhoto" src="" alt="" onclick="openLightbox(currentModalBike?.photos?.[modalPhotoIdx] || '')" />
      <button class="modal-close-btn" onclick="closeDetailDirect()">âœ•</button>
      <div class="modal-hero-nav">
        <button class="modal-nav-btn" onclick="modalNavPhoto(-1)">â€¹</button>
        <button class="modal-nav-btn" onclick="modalNavPhoto(1)">â€º</button>
      </div>
      <div class="modal-photo-count" id="modalPhotoCount"></div>
    </div>
    <div class="modal-thumbs" id="modalThumbs"></div>
    <div class="modal-body">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modalTitle"></div>
          <div style="color:var(--text-secondary);font-size:0.85rem;margin-top:0.2rem" id="modalMeta"></div>
          <div style="margin-top:0.4rem" id="modalStars"></div>
        </div>
        <div class="modal-price" id="modalPrice"></div>
      </div>
      <div class="modal-grid" id="modalGrid"></div>
      <div class="modal-notes" id="modalNotes" style="display:none"></div>
      <div class="modal-footer" id="modalFooter"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ SHARE MODAL â”€â”€ -->
<div class="modal-overlay" id="shareModal" onclick="closeShareModal(event)">
  <div class="modal" id="shareModalInner" style="max-width:520px">
    <div class="modal-body" style="padding:2rem">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.2rem">
        <div>
          <div class="modal-title" style="font-size:1.4rem">ğŸ”— SdÃ­let seznam</div>
          <div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.2rem">Odkaz obsahuje vÅ¡echna data vÄetnÄ› nÃ¡hledovÃ© fotografie</div>
        </div>
        <button class="modal-close-btn" style="position:static;background:var(--bg-3)" onclick="closeShareModalDirect()">âœ•</button>
      </div>

      <div id="shareInfo" style="font-size:0.82rem;color:var(--text-secondary);margin-bottom:1rem;padding:0.7rem 1rem;background:var(--bg-3);border-radius:var(--radius);line-height:1.7"></div>

      <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem">
        <input id="shareUrlInput" readonly
          style="flex:1;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);color:var(--text-primary);font-size:0.78rem;padding:0.55rem 0.8rem;outline:none;font-family:monospace;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" />
        <button class="btn btn-primary" onclick="copyShareUrl()" id="copyBtn">KopÃ­rovat</button>
      </div>

      <div id="shareSizeWarn" style="display:none;font-size:0.78rem;color:var(--gold);padding:0.5rem 0.8rem;background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:var(--radius)">
        âš  URL je delÅ¡Ã­ â€” nÄ›kterÃ© aplikace mohou mÃ­t problÃ©m s odeslÃ¡nÃ­m. DoporuÄujeme sdÃ­let pÅ™es WhatsApp nebo e-mail.
      </div>
    </div>
  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">âœ•</button>
  <img id="lightboxImg" src="" alt="Photo" />
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let bikes = JSON.parse(localStorage.getItem('moto_compare_bikes') || '[]');
let manualRating = 0;
let currentSort = 'added';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  renderAll();
  initSortBtns();
  initStars();
  loadSharedData();
});

function save() {
  localStorage.setItem('moto_compare_bikes', JSON.stringify(bikes));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FETCH FROM URL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchBike() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) { toast('VloÅ¾ URL inzerÃ¡tu', 'error'); return; }

  setStatus('loading', 'NaÄÃ­tÃ¡m strÃ¡nku inzerÃ¡tuâ€¦');
  const bike = await fetchSingleUrl(url);

  if (!bike) {
    setStatus('error', 'NepodaÅ™ilo se naÄÃ­st nebo rozpoznat data. Zkus jinÃ½ zdroj nebo pÅ™idej ruÄnÄ›.');
    return;
  }

  bikes.push(bike);
  save();
  renderAll();
  setStatus('success', `âœ“ PÅ™idÃ¡no: ${bike.model} (${bike.year || '?'}) â€” ${formatPrice(bike.price)}`);
  document.getElementById('urlInput').value = '';
  document.getElementById('compare').scrollIntoView({ behavior: 'smooth' });
  toast(`${bike.model} pÅ™idÃ¡n do srovnÃ¡nÃ­`, 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARSER â€” pokryje sauto.cz, tipcars.com, bazos.cz, mobile.de
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseMotorcycleData(html, url) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, 'text/html');
  const text = doc.body ? doc.body.innerText || doc.body.textContent : html;

  const bike = {
    id: Date.now(),
    url,
    model: null, year: null, price: null, km: null,
    origin: null, stk: null, power: null, ccm: null,
    photos: [], notes: '', rating: 0, added: Date.now()
  };

  // â”€â”€ MODEL â”€â”€
  const titleCandidates = [
    doc.querySelector('h1'),
    doc.querySelector('[class*="title"]'),
    doc.querySelector('[class*="heading"]'),
    doc.querySelector('meta[property="og:title"]'),
    doc.querySelector('meta[name="title"]'),
  ];
  for (const el of titleCandidates) {
    const t = el ? (el.getAttribute('content') || el.textContent || '').trim() : '';
    if (t.length > 3) { bike.model = cleanModel(t); break; }
  }
  if (!bike.model) {
    const m = text.match(/(?:BMW|Honda|Yamaha|Kawasaki|Suzuki|KTM|Ducati|Triumph|Royal Enfield|Harley|Husqvarna|Aprilia|MV Agusta|Benelli|CFMoto|Moto Guzzi|Indian|Beta|Sherco)[^,\n<]{3,60}/i);
    if (m) bike.model = cleanModel(m[0]);
  }

  // â”€â”€ YEAR â”€â”€
  const yearM = text.match(/\b(19[89]\d|20[012]\d)\b/);
  if (yearM) bike.year = parseInt(yearM[1]);

  // â”€â”€ PRICE â”€â”€
  const priceM = text.match(/(\d[\d\s\.]+)\s*(?:KÄ|CZK|EUR|â‚¬|,-)/i);
  if (priceM) bike.price = parseInt(priceM[1].replace(/[\s\.]/g, ''));

  // â”€â”€ KM â”€â”€
  const kmM = text.match(/(\d[\d\s]+)\s*(?:km|kilomet)/i);
  if (kmM) bike.km = parseInt(kmM[1].replace(/\s/g, ''));

  // â”€â”€ ORIGIN â”€â”€
  const origins = { CZ:'ÄŒeskÃ¡ republika', SK:'Slovensko', DE:'NÄ›mecko', AT:'Rakousko', PL:'Polsko', HU:'MaÄarsko', IT:'ItÃ¡lie', FR:'Francie', GB:'VelkÃ¡ BritÃ¡nie' };
  for (const [code, name] of Object.entries(origins)) {
    if (text.includes(name)) { bike.origin = code; break; }
  }

  // â”€â”€ STK â”€â”€
  const stkM = text.match(/STK[^0-9]*(\d{1,2}[\/\.\-]\d{2,4})/i);
  if (stkM) bike.stk = stkM[1];

  // â”€â”€ POWER â”€â”€
  const pwM = text.match(/(\d{2,3})\s*(?:kW|KW)/);
  if (pwM) bike.power = parseInt(pwM[1]);
  const hpM = text.match(/(\d{2,3})\s*(?:k|ps|hp|ks)\b/i);
  if (hpM && !bike.power) bike.power = Math.round(parseInt(hpM[1]) * 0.7355);

  // â”€â”€ CCM â”€â”€
  const ccmM = text.match(/(\d{3,4})\s*(?:ccm|cm3|cc)\b/i);
  if (ccmM) bike.ccm = parseInt(ccmM[1]);

  // â”€â”€ PHOTOS â”€â”€
  // Priority 1: OG image (most reliable â€” set by the site explicitly for the listing)
  const photoUrls = [];
  const og = doc.querySelector('meta[property="og:image"]');
  if (og) {
    const ogsrc = og.getAttribute('content');
    if (ogsrc && ogsrc.startsWith('http')) photoUrls.push(ogsrc);
  }

  // Priority 2: JSON-LD structured data (sauto, tipcars etc. embed image arrays here)
  doc.querySelectorAll('script[type="application/ld+json"]').forEach(s => {
    try {
      const data = JSON.parse(s.textContent);
      const imgs = data.image || data.images || [];
      (Array.isArray(imgs) ? imgs : [imgs]).forEach(i => {
        const src = typeof i === 'string' ? i : i?.url || i?.contentUrl || '';
        if (src && src.startsWith('http') && !photoUrls.includes(src)) photoUrls.push(src);
      });
    } catch(e) {}
  });

  // Priority 3: <img> tags â€” aggressively filter out non-photo images
  const badSrcPattern = /logo|icon|sprite|pixel|placeholder|banner|avatar|badge|arrow|btn|button|advert|reklam|tracking|analytics|stat\.|\.gif/i;
  const badDomainPattern = /google|facebook|twitter|gstatic|gravatar|addthis|doubleclick|ads\.|analytics/i;
  const imgs = [...doc.querySelectorAll('img[src], img[data-src], img[data-original], img[data-lazy]')];

  for (const img of imgs) {
    // pick best src attribute
    const src = img.dataset.src || img.dataset.original || img.dataset.lazy || img.getAttribute('src') || '';
    if (!src || src.startsWith('data:') || src.length < 12) continue;

    // skip bad patterns in URL
    if (badSrcPattern.test(src)) continue;

    // skip tiny images by declared dimensions
    const w = parseInt(img.getAttribute('width') || img.naturalWidth || 0);
    const h = parseInt(img.getAttribute('height') || img.naturalHeight || 0);
    if ((w > 0 && w < 100) || (h > 0 && h < 80)) continue;

    const abs = toAbsolute(src, url);
    if (!abs) continue;
    if (badDomainPattern.test(abs)) continue;
    if (!photoUrls.includes(abs)) photoUrls.push(abs);
    if (photoUrls.length >= 16) break;
  }

  bike.photos = photoUrls.slice(0, 16);

  return bike;
}

function cleanModel(s) {
  return s.replace(/\s+/g, ' ').replace(/\|.*$/, '').replace(/â€“.*$/, '').replace(/\d{5,}/g,'').trim().slice(0,80);
}

function toAbsolute(src, base) {
  try {
    if (src.startsWith('http')) return src;
    return new URL(src, base).href;
  } catch { return null; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BULK URL FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleBulk() {
  const sec = document.getElementById('bulkSection');
  const btn = document.getElementById('bulkToggleBtn');
  const open = sec.style.display === 'none';
  sec.style.display = open ? 'block' : 'none';
  btn.textContent = open ? 'âœ• ZavÅ™Ã­t' : 'âŠ PÅ™idat vÃ­ce URL najednou';
}

document.addEventListener('DOMContentLoaded', () => {
  const ta = document.getElementById('bulkInput');
  if (ta) {
    ta.addEventListener('input', () => {
      const urls = ta.value.split('\n').map(s=>s.trim()).filter(s=>s.length>5);
      document.getElementById('bulkCounter').textContent = `${urls.length} URL`;
    });
  }
});

let bulkAborted = false;

function stopBulk() {
  bulkAborted = true;
  document.getElementById('bulkStopBtn').textContent = 'â¹ Zastavujiâ€¦';
  document.getElementById('bulkStopBtn').disabled = true;
}

async function fetchBulk() {
  const ta = document.getElementById('bulkInput');
  const urls = ta.value.split('\n').map(s=>s.trim()).filter(s=>s.startsWith('http'));
  if (!urls.length) { toast('VloÅ¾ alespoÅˆ jednu URL', 'error'); return; }
  if (urls.length > 50) { toast('Maximum je 50 URL najednou', 'error'); return; }

  bulkAborted = false;
  const startBtn = document.getElementById('bulkStartBtn');
  const stopBtn = document.getElementById('bulkStopBtn');
  startBtn.disabled = true;
  startBtn.textContent = 'â³ NaÄÃ­tÃ¡mâ€¦';
  stopBtn.style.display = 'inline-flex';
  stopBtn.disabled = false;
  stopBtn.textContent = 'â¹ Stop';

  const progress = document.getElementById('bulkProgress');
  const bar = document.getElementById('bulkProgressBar');
  const log = document.getElementById('bulkLog');
  progress.style.display = 'block';
  log.innerHTML = '';

  let done = 0;
  let added = 0;
  for (const url of urls) {
    if (bulkAborted) {
      log.innerHTML += `<div style="color:var(--gold)">â¹ Zastaveno po ${done} URL</div>`;
      break;
    }

    const shortUrl = url.replace(/https?:\/\//, '').slice(0, 50) + (url.length > 55 ? 'â€¦' : '');
    log.innerHTML += `<div id="log-${done}">â³ ${shortUrl}</div>`;
    log.scrollTop = log.scrollHeight;

    try {
      const bike = await fetchSingleUrl(url);
      if (bike) {
        bikes.push(bike);
        save();
        added++;
        document.getElementById(`log-${done}`).innerHTML = `<span style="color:var(--green)">âœ“ ${bike.model || shortUrl}</span>`;
      } else {
        document.getElementById(`log-${done}`).innerHTML = `<span style="color:var(--red)">âœ• Nelze naÄÃ­st: ${shortUrl}</span>`;
      }
    } catch(e) {
      document.getElementById(`log-${done}`).innerHTML = `<span style="color:var(--red)">âœ• Chyba: ${shortUrl}</span>`;
    }

    done++;
    bar.style.width = `${(done/urls.length)*100}%`;
    await new Promise(r => setTimeout(r, 600));
  }

  renderAll();
  const msg = bulkAborted
    ? `Zastaveno â€” pÅ™idÃ¡no ${added} z ${done} zpracovanÃ½ch`
    : `Hotovo: pÅ™idÃ¡no ${added} z ${urls.length}`;
  toast(msg, bulkAborted ? 'info' : 'success');

  startBtn.disabled = false;
  startBtn.textContent = 'â¬‡ NaÄÃ­st vÅ¡echny';
  stopBtn.style.display = 'none';
  if (!bulkAborted) bar.style.width = '100%';
}

async function fetchSingleUrl(url) {
  const proxyFetchers = [
    async (u) => {
      const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(u)}`, { signal: AbortSignal.timeout(10000) });
      const d = await r.json();
      return d.contents && d.contents.length > 1000 ? d.contents : null;
    },
    async (u) => {
      const r = await fetch(`https://corsproxy.io/?${encodeURIComponent(u)}`, { signal: AbortSignal.timeout(10000) });
      const t = await r.text();
      return t.length > 1000 ? t : null;
    },
    async (u) => {
      const r = await fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`, { signal: AbortSignal.timeout(10000) });
      const t = await r.text();
      return t.length > 1000 ? t : null;
    }
  ];

  let html = null;
  for (const fetcher of proxyFetchers) {
    try { html = await fetcher(url); if (html) break; } catch(e) { continue; }
  }
  if (!html) return null;

  const isHardBlock = (
    (html.includes('Access Denied') && !html.includes('<title')) ||
    html.includes('cf-browser-verification') ||
    html.includes('challenge-form') ||
    (html.includes('captcha') && html.length < 5000)
  );
  if (isHardBlock) return null;

  const bike = parseMotorcycleData(html, url);
  return bike.model ? bike : null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MANUAL ADD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleManual() {
  const f = document.getElementById('manualForm');
  f.classList.toggle('open');
}

function addManual() {
  const model = document.getElementById('f_model').value.trim();
  if (!model) { toast('VyplÅˆ alespoÅˆ model', 'error'); return; }

  const stkVal = document.getElementById('f_stk').value;
  const photoUrl = document.getElementById('f_photo').value.trim();

  const bike = {
    id: Date.now(),
    url: document.getElementById('f_url').value.trim(),
    model,
    year: parseInt(document.getElementById('f_year').value) || null,
    price: parseInt(document.getElementById('f_price').value) || null,
    km: parseInt(document.getElementById('f_km').value) || null,
    origin: document.getElementById('f_origin').value || null,
    stk: stkVal || null,
    power: parseInt(document.getElementById('f_power').value) || null,
    ccm: parseInt(document.getElementById('f_ccm').value) || null,
    photos: photoUrl ? [photoUrl] : [],
    notes: document.getElementById('f_notes').value.trim(),
    rating: manualRating,
    added: Date.now()
  };

  bikes.push(bike);
  save();
  renderAll();
  toggleManual();
  clearManualForm();
  toast(`${bike.model} pÅ™idÃ¡n`, 'success');
  document.getElementById('compare').scrollIntoView({ behavior: 'smooth' });
}

function clearManualForm() {
  ['f_model','f_year','f_price','f_km','f_power','f_ccm','f_url','f_photo','f_notes'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('f_origin').value = '';
  document.getElementById('f_stk').value = '';
  manualRating = 0;
  updateStars(0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STAR RATING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initStars() {
  document.querySelectorAll('#starRow .star').forEach(star => {
    star.addEventListener('click', () => {
      manualRating = parseInt(star.dataset.v);
      updateStars(manualRating);
    });
  });
}
function updateStars(val) {
  document.querySelectorAll('#starRow .star').forEach(s => {
    s.classList.toggle('active', parseInt(s.dataset.v) <= val);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getSorted() {
  const b = [...bikes];
  switch(currentSort) {
    case 'price_asc': return b.sort((a,z) => (a.price||Infinity)-(z.price||Infinity));
    case 'price_desc': return b.sort((a,z) => (z.price||0)-(a.price||0));
    case 'km': return b.sort((a,z) => (a.km||Infinity)-(z.km||Infinity));
    case 'year': return b.sort((a,z) => (z.year||0)-(a.year||0));
    case 'rating': return b.sort((a,z) => (z.rating||0)-(a.rating||0));
    case 'favorite': return b.sort((a,z) => (z.favorite?1:0)-(a.favorite?1:0));
    default: return b.sort((a,z) => a.added - z.added);
  }
}

function renderAll() {
  updateHeader();
  renderCards();
  renderTable();
}

function updateHeader() {
  const n = bikes.length;
  const el = document.getElementById('headerCount');
  el.textContent = `${n} motocykl${n===1?'':'Å¯'}`;
  el.classList.toggle('visible', n > 0);
  const suffix = n===1 ? '' : (n>=2 && n<=4) ? 'y' : 'Å¯';
  document.getElementById('bikeCount').textContent = `${n} motocykl${suffix} v databÃ¡zi`;
}

// find best value (lowest price & km combo)
function getBestValue() {
  const withBoth = bikes.filter(b => b.price && b.km);
  if (withBoth.length < 2) return null;
  return withBoth.reduce((best, b) => {
    const score = (b.price / 100000) + (b.km / 10000);
    const bScore = (best.price / 100000) + (best.km / 10000);
    return score < bScore ? b : best;
  });
}

function renderCards() {
  const grid = document.getElementById('bikesGrid');
  const empty = document.getElementById('emptyState');
  const sorted = getSorted();
  const best = getBestValue();

  if (!sorted.length) {
    grid.innerHTML = '';
    empty.classList.add('visible');
    return;
  }
  empty.classList.remove('visible');

  grid.innerHTML = sorted.map(bike => {
    const isBest = best && best.id === bike.id;
    const photo = bike.photos?.[0];
    const stk = stkBadge(bike.stk);
    const photoCount = bike.photos?.length || 0;

    return `
    <div class="bike-card${isBest ? ' best-value' : ''}" id="card-${bike.id}">
      <div style="position:relative;cursor:pointer" onclick="openDetail(${bike.id})">
        ${photo
          ? `<img class="bike-photo" src="${photo}" alt="${bike.model}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" loading="lazy"/><div class="bike-photo-placeholder" style="display:none">ğŸ</div>`
          : `<div class="bike-photo-placeholder">ğŸ</div>`}
        ${photoCount > 1 ? `<div style="position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,0.6);color:white;font-size:0.7rem;font-family:'Barlow Condensed',sans-serif;font-weight:600;letter-spacing:0.08em;padding:2px 8px;border-radius:20px">ğŸ“· ${photoCount}</div>` : ''}
        <button class="fav-btn${bike.favorite ? ' active' : ''}" onclick="event.stopPropagation();toggleFavorite(${bike.id})" title="${bike.favorite ? 'Odebrat z oblÃ­benÃ½ch' : 'PÅ™idat do oblÃ­benÃ½ch'}">${bike.favorite ? 'â˜…' : 'â˜†'}</button>
      </div>
      <div class="bike-body">
        <div class="bike-model" style="display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap">
          ${bike.model}
          ${bike.favorite ? `<span class="fav-badge">â˜… OblÃ­benÃ½</span>` : ''}
        </div>
        <div class="bike-year-origin">
          ${bike.year || '?'} ${bike.origin ? 'Â· ' + flagOf(bike.origin) + ' ' + bike.origin : ''}
          ${getDomain(bike.url) ? `Â· <span style="color:var(--text-muted);font-size:0.75rem">${getDomain(bike.url)}</span>` : ''}
        </div>
        <div class="bike-price">${formatPrice(bike.price)}</div>
        <div class="bike-stats">
          <div class="bike-stat"><span class="label">NajetÃ© km</span><span class="value">${bike.km ? bike.km.toLocaleString('cs-CZ') + ' km' : 'â€”'}</span></div>
          <div class="bike-stat"><span class="label">STK</span><span class="value">${stk}</span></div>
          <div class="bike-stat"><span class="label">VÃ½kon</span><span class="value">${bike.power ? bike.power + ' kW' : 'â€”'}</span></div>
          <div class="bike-stat"><span class="label">Objem</span><span class="value">${bike.ccm ? bike.ccm + ' ccm' : 'â€”'}</span></div>
        </div>
        ${bike.rating ? `<div class="bike-stars">${'â˜…'.repeat(bike.rating)}<span style="color:var(--text-muted)">${'â˜…'.repeat(5-bike.rating)}</span></div>` : ''}
        <div class="bike-actions" style="margin-top:0.7rem">
          <button class="btn btn-primary btn-sm" onclick="openDetail(${bike.id})">Detail â†’</button>
          ${bike.url ? `<a href="${bike.url}" class="bike-url-link" target="_blank">â†— InzerÃ¡t</a>` : ''}
          <button class="btn btn-ghost btn-sm" onclick="editNotes(${bike.id})">âœ</button>
          <button class="btn btn-danger btn-sm" onclick="removeBike(${bike.id})">âœ•</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

// table-level sort state (separate from card sort)
let tableSortCol = null;
let tableSortDir = 1; // 1=asc, -1=desc

function tableSort(col) {
  if (tableSortCol === col) {
    tableSortDir *= -1;
  } else {
    tableSortCol = col;
    tableSortDir = col === 'price' || col === 'km' ? 1 : -1; // numbers default asc, text default desc
  }
  // update header icons
  document.querySelectorAll('.th-sort').forEach(th => {
    const icon = th.querySelector('.sort-icon');
    if (th.dataset.col === col) {
      icon.textContent = tableSortDir === 1 ? ' â†‘' : ' â†“';
      th.style.color = 'var(--bmw-blue-light)';
    } else {
      icon.textContent = ' â‡…';
      th.style.color = '';
    }
  });
  renderTable();
}

function getTableFiltered() {
  let data = getSorted();
  const fModel = document.getElementById('fModel')?.value.trim().toLowerCase();
  const fYearMin = parseInt(document.getElementById('fYearMin')?.value);
  const fYearMax = parseInt(document.getElementById('fYearMax')?.value);
  const fPriceMax = parseInt(document.getElementById('fPriceMax')?.value);
  const fKmMax = parseInt(document.getElementById('fKmMax')?.value);
  const fOrigin = document.getElementById('fOrigin')?.value;
  const fStk = document.getElementById('fStk')?.value;
  const fRating = parseInt(document.getElementById('fRating')?.value) || 0;

  if (fModel) data = data.filter(b => b.model.toLowerCase().includes(fModel));
  if (!isNaN(fYearMin)) data = data.filter(b => b.year && b.year >= fYearMin);
  if (!isNaN(fYearMax)) data = data.filter(b => b.year && b.year <= fYearMax);
  if (!isNaN(fPriceMax)) data = data.filter(b => b.price && b.price <= fPriceMax);
  if (!isNaN(fKmMax)) data = data.filter(b => b.km && b.km <= fKmMax);
  if (fOrigin) data = data.filter(b => b.origin === fOrigin);
  if (fStk) {
    data = data.filter(b => {
      const d = parseSTK(b.stk);
      const now = new Date();
      if (!d) return fStk === 'unknown';
      const diff = (d - now) / (1000*60*60*24*30);
      if (fStk === 'ok') return diff >= 3;
      if (fStk === 'warn') return diff >= 0 && diff < 3;
      return false;
    });
  }
  if (fRating > 0) data = data.filter(b => (b.rating || 0) >= fRating);

  // apply table-level sort
  if (tableSortCol) {
    data = [...data].sort((a, z) => {
      let av = a[tableSortCol], zv = z[tableSortCol];
      if (typeof av === 'string') return av.localeCompare(zv) * tableSortDir;
      return ((av || 0) - (zv || 0)) * tableSortDir;
    });
  }
  return data;
}

function applyTableFilters() { renderTable(); }

function resetFilters() {
  ['fModel','fYearMin','fYearMax','fPriceMax','fKmMax'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  ['fOrigin','fStk','fRating'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = el.tagName === 'SELECT' && id === 'fRating' ? '0' : '';
  });
  tableSortCol = null;
  tableSortDir = 1;
  document.querySelectorAll('.th-sort').forEach(th => {
    th.querySelector('.sort-icon').textContent = ' â‡…';
    th.style.color = '';
  });
  renderTable();
}

function renderTable() {
  const tbody = document.getElementById('compTableBody');
  const tableSection = document.getElementById('tableSection');
  const tableEmpty = document.getElementById('tableEmpty');

  if (!bikes.length) { tableSection.style.display = 'none'; return; }
  tableSection.style.display = 'block';

  const filtered = getTableFiltered();
  document.getElementById('tableRowCount').textContent =
    filtered.length < bikes.length
      ? `${filtered.length} z ${bikes.length} motocyklÅ¯`
      : `${bikes.length} motocyklÅ¯`;

  if (!filtered.length) {
    tbody.innerHTML = '';
    tableEmpty.style.display = 'block';
    return;
  }
  tableEmpty.style.display = 'none';

  // highlight min/max in filtered set
  const prices = filtered.map(b => b.price).filter(Boolean);
  const kms = filtered.map(b => b.km).filter(Boolean);
  const minPrice = Math.min(...prices);
  const maxPrice = Math.max(...prices);
  const minKm = Math.min(...kms);
  const maxKm = Math.max(...kms);

  tbody.innerHTML = filtered.map(bike => {
    const photo = bike.photos?.[0];
    const pClass = bike.price === minPrice && prices.length > 1 ? 'val-best' : bike.price === maxPrice && prices.length > 1 ? 'val-worst' : '';
    const kClass = bike.km === minKm && kms.length > 1 ? 'val-best' : bike.km === maxKm && kms.length > 1 ? 'val-worst' : '';

    return `<tr>
      <td>${photo
        ? `<img class="thumb" src="${photo}" onerror="this.style.display='none'" loading="lazy"/>`
        : `<div class="thumb-placeholder">ğŸ</div>`}
      </td>
      <td><strong>${bike.model}</strong></td>
      <td>${bike.year || 'â€”'}</td>
      <td class="price-cell ${pClass}">${formatPrice(bike.price)}</td>
      <td class="${kClass}">${bike.km ? bike.km.toLocaleString('cs-CZ') + ' km' : 'â€”'}</td>
      <td>${bike.origin ? flagOf(bike.origin) + ' ' + bike.origin : 'â€”'}</td>
      <td>${stkBadge(bike.stk)}</td>
      <td>${bike.power ? bike.power + ' kW' : 'â€”'}</td>
      <td>${bike.ccm ? bike.ccm + ' ccm' : 'â€”'}</td>
      <td>${bike.rating ? 'â˜…'.repeat(bike.rating) : 'â€”'}</td>
      <td>
        ${getDomain(bike.url) ? `<span style="font-size:0.8rem;color:var(--text-secondary)">${getDomain(bike.url)}</span>` : 'â€”'}
        ${bike.url ? `<br><a href="${bike.url}" class="bike-url-link" target="_blank" style="font-size:0.72rem">â†— otevÅ™Ã­t</a>` : ''}
      </td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARE VIA URL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shareList() {
  if (!bikes.length) { toast('Nejsou Å¾Ã¡dnÃ¡ data ke sdÃ­lenÃ­', 'error'); return; }

  // Encode only essential fields + first photo
  const payload = bikes.map(b => ({
    id: b.id,
    url: b.url || '',
    model: b.model,
    year: b.year || null,
    price: b.price || null,
    km: b.km || null,
    origin: b.origin || null,
    stk: b.stk || null,
    power: b.power || null,
    ccm: b.ccm || null,
    photo: b.photos?.[0] || null,   // only first photo
    notes: b.notes || '',
    rating: b.rating || 0,
    added: b.added
  }));

  const json = JSON.stringify(payload);
  const encoded = btoa(unescape(encodeURIComponent(json)));
  const shareUrl = `${location.origin}${location.pathname}#share=${encoded}`;

  document.getElementById('shareUrlInput').value = shareUrl;

  const kb = Math.round(encoded.length / 1024 * 10) / 10;
  const photos = payload.filter(b => b.photo).length;
  document.getElementById('shareInfo').innerHTML =
    `ğŸ“‹ <strong>${bikes.length} motocyklÅ¯</strong> Â· ${photos} s nÃ¡hledovou fotkou Â· velikost URL: <strong>${kb} kB</strong>`;

  const warn = document.getElementById('shareSizeWarn');
  warn.style.display = encoded.length > 8000 ? 'block' : 'none';

  document.getElementById('shareModal').classList.add('open');
  document.body.style.overflow = 'hidden';

  // Select URL text
  setTimeout(() => document.getElementById('shareUrlInput').select(), 100);
}

function copyShareUrl() {
  const input = document.getElementById('shareUrlInput');
  navigator.clipboard.writeText(input.value).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = 'âœ“ ZkopÃ­rovÃ¡no';
    btn.style.background = 'var(--green)';
    setTimeout(() => { btn.textContent = 'KopÃ­rovat'; btn.style.background = ''; }, 2500);
  }).catch(() => {
    input.select();
    document.execCommand('copy');
    toast('ZkopÃ­rovÃ¡no', 'success');
  });
}

function closeShareModal(e) {
  if (e.target === document.getElementById('shareModal')) closeShareModalDirect();
}
function closeShareModalDirect() {
  document.getElementById('shareModal').classList.remove('open');
  document.body.style.overflow = '';
}

// Load shared data from URL hash on page load
function loadSharedData() {
  const hash = location.hash;
  if (!hash.startsWith('#share=')) return;

  try {
    const encoded = hash.slice(7);
    const json = decodeURIComponent(escape(atob(encoded)));
    const shared = JSON.parse(json);

    if (!Array.isArray(shared) || !shared.length) return;

    // Restore photos array from single photo
    const restored = shared.map(b => ({
      ...b,
      photos: b.photo ? [b.photo] : []
    }));

    // Ask user what to do
    const msg = `Byl sdÃ­len seznam ${restored.length} motocyklÅ¯.

Co chceÅ¡ udÄ›lat?
OK = Nahradit moje data sdÃ­lenÃ½mi
ZruÅ¡it = PÅ™idat sdÃ­lenÃ© k mÃ½m datÅ¯m`;
    if (confirm(msg)) {
      bikes = restored;
    } else {
      // Merge â€” avoid duplicates by id
      const existingIds = new Set(bikes.map(b => b.id));
      restored.forEach(b => { if (!existingIds.has(b.id)) bikes.push(b); });
    }

    save();
    renderAll();
    history.replaceState(null, '', location.pathname); // clean URL
    toast(`NaÄteno ${restored.length} motocyklÅ¯ ze sdÃ­lenÃ©ho odkazu`, 'success');
  } catch(e) {
    toast('NepodaÅ™ilo se naÄÃ­st sdÃ­lenÃ¡ data', 'error');
    history.replaceState(null, '', location.pathname);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function formatPrice(p) {
  if (!p) return 'â€”';
  return p.toLocaleString('cs-CZ') + ' KÄ';
}

function getDomain(url) {
  if (!url) return null;
  try {
    const h = new URL(url).hostname.replace(/^www\./, '');
    return h;
  } catch { return null; }
}

function stkBadge(stk) {
  if (!stk) return '<span class="stk-badge stk-unknown">neznÃ¡mÃ¡</span>';
  const d = parseSTK(stk);
  if (!d) return `<span class="stk-badge stk-unknown">${stk}</span>`;
  const now = new Date();
  const diff = (d - now) / (1000*60*60*24*30);
  if (diff < 0) return `<span class="stk-badge stk-warn">âš  ExpirovanÃ¡</span>`;
  if (diff < 3) return `<span class="stk-badge stk-warn">âš  ${stk}</span>`;
  return `<span class="stk-badge stk-ok">âœ“ ${stk}</span>`;
}

function parseSTK(s) {
  if (!s) return null;
  const m = s.match(/(\d{1,2})[\/\.\-](\d{2,4})/);
  if (!m) return null;
  const month = parseInt(m[1]) - 1;
  const year = m[2].length === 2 ? 2000 + parseInt(m[2]) : parseInt(m[2]);
  return new Date(year, month);
}

function flagOf(code) {
  const flags = {CZ:'ğŸ‡¨ğŸ‡¿',SK:'ğŸ‡¸ğŸ‡°',DE:'ğŸ‡©ğŸ‡ª',AT:'ğŸ‡¦ğŸ‡¹',PL:'ğŸ‡µğŸ‡±',HU:'ğŸ‡­ğŸ‡º',IT:'ğŸ‡®ğŸ‡¹',FR:'ğŸ‡«ğŸ‡·',GB:'ğŸ‡¬ğŸ‡§',US:'ğŸ‡ºğŸ‡¸',Other:'ğŸŒ'};
  return flags[code] || '';
}

function setStatus(type, msg) {
  const el = document.getElementById('statusBar');
  el.className = 'status-bar show ' + type;
  el.innerHTML = type === 'loading'
    ? `<div class="spinner"></div>${msg}`
    : (type === 'success' ? 'âœ“ ' : 'âœ• ') + msg;
}

function removeBike(id) {
  bikes = bikes.filter(b => b.id !== id);
  save(); renderAll();
  toast('Motocykl odebrÃ¡n', 'info');
}

function clearAll() {
  if (!bikes.length) return;
  if (!confirm('Opravdu vymazat vÅ¡echny motocykly?')) return;
  bikes = []; save(); renderAll();
  toast('DatabÃ¡ze vymazÃ¡na', 'info');
}

function editNotes(id) {
  const bike = bikes.find(b => b.id === id);
  if (!bike) return;
  const note = prompt('PoznÃ¡mky k motocyklu:', bike.notes || '');
  if (note === null) return;
  bike.notes = note;
  save(); renderAll();
}

function exportCSV() {
  if (!bikes.length) { toast('Å½Ã¡dnÃ¡ data k exportu', 'error'); return; }
  const cols = ['Model','Rok','Cena (KÄ)','Km','PÅ¯vod','STK','VÃ½kon (kW)','Objem (ccm)','HodnocenÃ­','URL'];
  const rows = bikes.map(b => [
    `"${b.model}"`, b.year||'', b.price||'', b.km||'', b.origin||'', b.stk||'', b.power||'', b.ccm||'', b.rating||'', `"${b.url||''}"`
  ].join(';'));
  const csv = [cols.join(';'), ...rows].join('\n');
  const blob = new Blob(['\uFEFF'+csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `gs-compare-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  toast('CSV exportovÃ¡no', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentModalBike = null;
let modalPhotoIdx = 0;

function openDetail(id) {
  const bike = bikes.find(b => b.id === id);
  if (!bike) return;
  currentModalBike = bike;
  modalPhotoIdx = 0;

  document.getElementById('modalTitle').textContent = bike.model;
  document.getElementById('modalMeta').textContent =
    [bike.year, bike.origin ? flagOf(bike.origin) + ' ' + bike.origin : null].filter(Boolean).join(' Â· ');
  document.getElementById('modalPrice').textContent = formatPrice(bike.price);
  document.getElementById('modalStars').innerHTML =
    (bike.rating ? `<span style="color:var(--gold)">${'â˜…'.repeat(bike.rating)}</span><span style="color:var(--text-muted)">${'â˜…'.repeat(5-bike.rating)}</span>` : '') +
    (bike.favorite ? ' &nbsp;<span class="fav-badge">â˜… OblÃ­benÃ½</span>' : '');

  // stats grid
  const stats = [
    { label: 'NajetÃ© km', value: bike.km ? bike.km.toLocaleString('cs-CZ') + ' km' : 'â€”' },
    { label: 'STK', value: stkBadge(bike.stk) },
    { label: 'VÃ½kon', value: bike.power ? bike.power + ' kW' : 'â€”' },
    { label: 'Objem', value: bike.ccm ? bike.ccm + ' ccm' : 'â€”' },
    { label: 'PÅ¯vod', value: bike.origin ? flagOf(bike.origin) + ' ' + bike.origin : 'â€”' },
    { label: 'Zdroj', value: getDomain(bike.url) || 'â€”' },
    { label: 'PÅ™idÃ¡no', value: new Date(bike.added).toLocaleDateString('cs-CZ') },
  ];
  document.getElementById('modalGrid').innerHTML = stats.map(s =>
    `<div class="modal-stat"><div class="label">${s.label}</div><div class="value">${s.value}</div></div>`
  ).join('');

  // notes
  const notesEl = document.getElementById('modalNotes');
  if (bike.notes) { notesEl.textContent = bike.notes; notesEl.style.display = 'block'; }
  else { notesEl.style.display = 'none'; }

  // footer
  document.getElementById('modalFooter').innerHTML = `
    ${bike.url ? `<a href="${bike.url}" class="btn btn-primary" target="_blank">â†— OtevÅ™Ã­t inzerÃ¡t</a>` : ''}
    <button class="btn btn-ghost" onclick="editNotes(${bike.id});closeDetailDirect()">âœ Upravit poznÃ¡mky</button>
    <button class="btn btn-danger" onclick="if(confirm('Odstranit?')){removeBike(${bike.id});closeDetailDirect()}">âœ• Odebrat</button>
  `;

  // photos
  updateModalPhoto();

  document.getElementById('detailModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function updateModalPhoto() {
  const bike = currentModalBike;
  if (!bike) return;
  const photos = bike.photos || [];
  const main = document.getElementById('modalMainPhoto');
  const countEl = document.getElementById('modalPhotoCount');
  const thumbs = document.getElementById('modalThumbs');
  const nav = document.querySelectorAll('.modal-nav-btn');

  if (photos.length > 0) {
    main.src = photos[modalPhotoIdx];
    main.style.display = 'block';
    countEl.textContent = `${modalPhotoIdx + 1} / ${photos.length}`;
    nav.forEach(b => b.style.display = photos.length > 1 ? 'flex' : 'none');
  } else {
    main.style.display = 'none';
    countEl.textContent = '';
    nav.forEach(b => b.style.display = 'none');
  }

  thumbs.innerHTML = photos.map((p, i) =>
    `<img class="modal-thumb${i === modalPhotoIdx ? ' active' : ''}" src="${p}" loading="lazy" onclick="setModalPhoto(${i})" />`
  ).join('');
  thumbs.style.display = photos.length > 1 ? 'flex' : 'none';
}

function setModalPhoto(idx) {
  modalPhotoIdx = idx;
  updateModalPhoto();
}

function modalNavPhoto(dir) {
  const len = currentModalBike?.photos?.length || 1;
  modalPhotoIdx = (modalPhotoIdx + dir + len) % len;
  updateModalPhoto();
}

function closeDetail(e) {
  if (e.target === document.getElementById('detailModal')) closeDetailDirect();
}
function closeDetailDirect() {
  document.getElementById('detailModal').classList.remove('open');
  document.body.style.overflow = '';
}

// keyboard nav in modal
document.addEventListener('keydown', e => {
  if (!document.getElementById('detailModal').classList.contains('open')) return;
  if (e.key === 'Escape') closeDetailDirect();
  if (e.key === 'ArrowLeft') modalNavPhoto(-1);
  if (e.key === 'ArrowRight') modalNavPhoto(1);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FAVORITE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleFavorite(id) {
  const bike = bikes.find(b => b.id === id);
  if (!bike) return;
  bike.favorite = !bike.favorite;
  save();
  renderAll();
  toast(bike.favorite ? `â˜… ${bike.model} pÅ™idÃ¡n do oblÃ­benÃ½ch` : `${bike.model} odebrÃ¡n z oblÃ­benÃ½ch`, bike.favorite ? 'success' : 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSortBtns() {
  document.querySelectorAll('.sort-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      currentSort = btn.dataset.sort;
      document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderAll();
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIGHTBOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openLightbox(src) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type = 'info') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  const icon = {success:'âœ“', error:'âœ•', info:'â„¹'}[type] || 'â„¹';
  el.innerHTML = `<span>${icon}</span> ${msg}`;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => { el.style.animation = 'fadeOut 0.3s forwards'; setTimeout(() => el.remove(), 300); }, 3000);
}
</script>
</body>
</html>
